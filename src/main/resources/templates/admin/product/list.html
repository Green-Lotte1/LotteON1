<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title>롯데ON::관리자 페이지</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://kit.fontawesome.com/20962f3e4b.js" crossorigin="anonymous"></script>    
    <script th:src="@{/js/admin/gnb.js}"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>
    <div id="admin-wrapper">
        <header>
            <div>
                <a th:href="@{/admin/index}" class="logo"><img th:src="@{/images/admin_logo.png}" alt="admin_logo"/></a>
                <p>
                    <span>홍길동님 반갑습니다.</span>
                    <a th:href="@{/}">HOME |</a>
                    <a th:href="@{/member/logout}">로그아웃 |</a>
                    <a th:href="@{/cs}">고객센터</a>
                </p>
            </div>
        </header>
        <main>
            <aside>
                <!-- Global Navigation Bar -->
                <ul id="gnb">
                    <li>
                        <a th:href="@{/admin/config/info}"><i class="fa fa-cogs" aria-hidden="true"></i>환경설정</a>
                        <ol>
                            <li><a th:href="@{/admin/config/info}">기본환경설정</a></li>
                            <li><a th:href="@{/admin/config/banner}">배너관리</a></li>
                        </ol>
                    </li>
                    <li>
                        <a th:href="@{/admin/index}"><i class="fas fa-store" aria-hidden="true"></i>상점관리</a>
                        <ol>
                            <li><a th:href="@{/admin/index}">판매자현황</a></li>
                            <li><a th:href="@{/admin/product/list}">재고관리</a></li>
                        </ol>
                    </li>
                    <li>
                        <a th:href="@{/admin/index}"><i class="fa fa-users" aria-hidden="true"></i>회원관리</a>
                        <ol>
                            <li><a th:href="@{/admin/index}">회원현황</a></li>
                            <li><a th:href="@{/admin/index}">포인트관리</a></li>
                            <li><a th:href="@{/admin/index}">비회원관리</a></li>
                            <li><a th:href="@{/admin/index}">접속자집계</a></li>
                        </ol>
                    </li>
                    <li>
                        <a th:href="@{/admin/product/list}"><i class="fas fa-box-open" aria-hidden="true"></i>상품관리</a>
                        <ol>
                            <li><a th:href="@{/admin/product/list}">상품현황</a></li>
                            <li><a th:href="@{/admin/product/register}">상품등록</a></li>
                            <li><a th:href="@{/admin/product/list}">재고관리</a></li>
                        </ol>
                    </li>
                    <li>
                        <a th:href="@{/admin/index}"><i class="fa fa-credit-card" aria-hidden="true"></i>주문관리</a>
                        <ol>
                            <li><a th:href="@{/admin/index}">주문현황</a></li>
                            <li><a th:href="@{/admin/index}">매출현황</a></li>
                            <li><a th:href="@{/admin/index}">결제관리</a></li>
                            <li><a th:href="@{/admin/index}">배송관리</a></li>
                        </ol>
                    </li>
                    <li>
                        <a th:href="@{/admin/index}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>게시판관리</a>
                        <ol>
                            <li><a th:href="@{/admin/index}">게시판현황</a></li>
                            <li><a th:href="@{/admin/index}">고객문의</a></li>
                        </ol>
                    </li>
                </ul>
            </aside>
            <section id="admin-product-list">
                <nav>
                    <h3>상품목록</h3>
                    <p>
                        HOME > 상품관리 > <strong>상품목록</strong>
                    </p>
                </nav>
                <!-- 상품목록 컨텐츠 시작 -->                                
                <section>
                    <div>
                        <select name="search">
                            <option value="search1">상품명</option>
                            <option value="search1">상품코드</option>
                            <option value="search1">제조사</option>
                            <option value="search1">판매자</option>                                    
                        </select>
                        <input type="text" name="search">
                    </div>
                    <table>
                        <tr>
                            <th><input class="selectAll" type="checkbox" name="all"/></th>
                            <th>이미지</th>
                            <th>상품코드</th>
                            <th>상품명</th>
                            <th>판매가격</th>
                            <th>할인율</th>
                            <th>포인트</th>
                            <th>재고</th>
                            <th>판매자</th>
                            <th>조회</th>
                            <th>관리</th>
                        </tr>

                        <tr th:each="product:${adminproducts}">
                            <td><input type="checkbox" name="prod"/></td>
                            <td><img th:src="@{/images/sample_thumb.jpg}" class="thumb"></td>
                            <td>[[${product.prodNo}]]</td>
                            <td>[[${product.prodName}]]</td>
                            <td>[[${product.price}]]</td>
                            <td>[[${product.discount}]]</td>
                            <td>[[${product.point}]]</td>
                            <td>[[${product.stock}]]</td>
                            <td>[[${product.seller}]]</td>
                            <td>[[${product.hit}]]</td>
                            <td>
                                <a id="deleteProduct" th:href="@{/admin/product/delete(prodNo=${product.prodNo})}">[삭제]</a>
                                <a th:href="@{/admin/product/modify(prodNo=${product.prodNo})}">[수정]</a>
                            </td>
                        </tr>
                    </table>

                    
                    <input type="button" value="선택삭제" />                          


                    <div class="paging">
                        <span class="prev">
                            <a href="#">&nbsp;이전</a>
                        </span>
                        <span class="num">
                            <a href="#" class="on">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <a href="#">4</a>
                            <a href="#">5</a>
                            <a href="#">6</a>
                            <a href="#">7</a>
                        </span>
                        <span class="next">
                            <a href="#">다음&nbsp;></a>
                        </span>
                        </div>

                </section>                

                
                <p class="ico info">
                    <strong>Tip!</strong>
                    전자상거래 등에서의 상품 등의 정보제공에 관한 고시에 따라 총 35개 상품군에 대해 상품 특성 등을 양식에 따라 입력할 수 있습니다.
                </p>

                <script>

                    $(function (){

                        // SELECT ALL
                        $('#selectAll').on('change', function() {
                            console.log('selectAll');

                            // ALL CHECK CHECKED
                            var allChecked = $(this).prop('checked');
                            // ALL CHECKBOX CHECKED
                            $('input[name^="prod"]').prop('checked', allChecked);

                            var selectedCartNos = "/";
                            const path = $('#path').val();

                            $('.deleteProduct').click(function (e) {
                                e.preventDefault();
                                alert('click');
                                console.log('delete here...1');
                                // 체크돼있는 prodNo를 배열로 만들어 넣음
                                $('input[name^="prod"]:checked').each(function () {
                                    selectedCartNos = selectedCartNos + $(this).val() + "/";
                                    //selectedCartNos.push($(this).val());
                                    console.log('반복');
                                });
                                console.log('delete here...2');
                                console.log('delete path: ' + path);
                                console.log(selectedCartNos);
                                // 체크돼있는 prodNo를 배열이 없다면 돌려보냄.
                                if (selectedCartNos === "/") {
                                    alert('선택된 상품이 없습니다.');
                                    return;
                                }
                                console.log('delete here...3');
                                // 체크된 prodNo 전체와 uid를 jsonData로 만듬
                                const jsonData = {
                                    "selectedCartNos": selectedCartNos
                                };

                                console.log(JSON.stringify(jsonData));
                                if (confirm('선택된 상품을 장바구니에서 삭제하시겠습니까?')) {
                                    console.log('delete here...4');
                                    // jsonData를 전송
                                    // traditional: true는 배열을 ajax로 보낼때 있어야됨.
                                    $.ajax({
                                        url: path + '/product/deleteCartProduct',
                                        type: 'post',
                                        data: JSON.stringify(jsonData),
                                        //traditional: true,
                                        dataType: 'json',
                                        contentType: 'application/json;charset=UTF-8',
                                        success: function (data) {
                                            console.log('delete here...5');
                                            // 삭제가 성공적으로 됐을때 알림 띄워주고 창 새로고침
                                            if (data > 0) {
                                                alert('장바구니에서 삭제되었습니다.');
                                                window.location.href = path + '/product/cart';
                                            } else if (data < 1) {
                                                alert('다시 시도해주세요.');
                                                return;
                                            }
                                        }
                                    })// ajax end
                                } else {
                                    return;
                                }// 삭제 confirm end
                            }); // 선택삭제 click end

                        });
                    });
                </script>

                <!-- 상품목록 컨텐츠 끝 -->
            </section>
        </main>
        <footer>
            <div>
                <p>Copyright ©lotteon.com All rights reserved. ADMINISTRATOR Version 5.4.1.2</p>
            </div>
        </footer>
    </div>    
</body>
</html>